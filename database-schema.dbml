// Weather Dashboard Database Schema
// Use DBML to define your database structure
// Docs: https://dbml.dbdiagram.io/docs
// Visualize at: https://dbdiagram.io/

Table users {
  id integer [primary key, increment, note: 'Unique user identifier']
  username varchar(50) [unique, not null, note: 'Unique username for login']
  email varchar(100) [unique, not null, note: 'User email address (unique)']
  password_hash varchar(255) [not null, note: 'Bcrypt hashed password']
  created_at timestamp [default: `CURRENT_TIMESTAMP`, note: 'Account creation timestamp']
  updated_at timestamp [default: `CURRENT_TIMESTAMP`, note: 'Last account update timestamp']
  
  Note: 'User accounts with authentication credentials'
}

Table favorite_cities {
  id integer [primary key, increment, note: 'Unique favorite entry identifier']
  user_id integer [not null, note: 'Reference to user who favorited the city']
  city_name varchar(100) [not null, note: 'Name of the favorite city']
  country_code varchar(2) [note: 'ISO 3166-1 alpha-2 country code']
  latitude decimal(10,8) [note: 'City latitude coordinate']
  longitude decimal(11,8) [note: 'City longitude coordinate']
  created_at timestamp [default: `CURRENT_TIMESTAMP`, note: 'When the city was favorited']
  
  indexes {
    user_id [name: 'idx_favorite_cities_user_id']
    (user_id, city_name) [unique, name: 'unique_user_city']
  }
  
  Note: 'User favorite cities with geographic coordinates'
}

Table weather_cache {
  id integer [primary key, increment, note: 'Unique cache entry identifier']
  city_name varchar(100) [not null, note: 'Cached city name']
  country_code varchar(2) [note: 'ISO 3166-1 alpha-2 country code']
  weather_data jsonb [not null, note: 'JSON weather data from API']
  cached_at timestamp [default: `CURRENT_TIMESTAMP`, note: 'When the data was cached']
  expires_at timestamp [not null, note: 'Cache expiration timestamp']
  
  indexes {
    (city_name, country_code) [unique, name: 'unique_city_cache']
    (city_name, country_code) [name: 'idx_weather_cache_city']
    expires_at [name: 'idx_weather_cache_expires']
  }
  
  Note: 'Cached weather data to minimize API calls'
}

// Relationships
Ref user_favorites: favorite_cities.user_id > users.id [delete: cascade]
